<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Smart Cart | Admin</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
/* === Base === */
html, body { height: 100%; margin:0; padding:0; font-family:"Segoe UI", Arial, sans-serif; padding-top:84px; background:#eef2f7;}
.navbarimg { height:48px; width:auto; border-radius:50%; object-fit:cover; }
.navbar .brand-text { font-weight:700; }
.navbar .nav-link { color:#0d6efd !important; font-weight:500; }
.navbar .nav-link:hover { color:#0b5ed7 !important; }
.navbar .nav-link.active { color:#0a58ca !important; }

/* === Cards === */
.contact-card {
  border-radius:16px;
  background:#fff;
  box-shadow:0 14px 30px rgba(0,0,0,.06);
  opacity:0;
  transform:translateY(14px);
  transition: transform .35s ease, opacity .5s ease;
}
.contact-card.show { opacity:1; transform:translateY(0); }
.contact-card .card-header { font-weight:700; }
.contact-card .btn { margin-right:0.5rem; margin-top:0.5rem; }

/* Footer */
footer { text-align:center; color:#6c757d; font-size:.9rem; margin-top:2rem; }

@media(max-width:576px){ .navbarimg{height:44px;} body{padding-left:12px; padding-right:12px;} }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="home.html">
      <img src="logo_placeholder_loginpage copy.jpeg" class="navbarimg me-2" alt="Logo">
      <span class="brand-text">Smart Cart</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-3">
        <li class="nav-item"><a class="nav-link active" href="#">Admin Panel </a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
        <li id="nav-auth" class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Container for contact cards -->
<main class="container py-5">
  <h2 class="mb-4">User Messages</h2>
  <div id="contactCards"></div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script type="module">
import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

const firebaseConfig = {
  apiKey:"AIzaSyAZpdtDkHAmCz9GosbJ-PkO4KM2iaNTfHQ",
  authDomain:"freecart11.firebaseapp.com",
  projectId:"freecart11",
  databaseURL:"https://freecart11-default-rtdb.europe-west1.firebasedatabase.app/",
  appId:"1:369725415465:web:8beecb3baf985ddddb7c38"
};

if(!getApps().length) initializeApp(firebaseConfig);
const auth = getAuth();
const db = getDatabase();

// Navbar auth
const navAuth = document.getElementById('nav-auth');
onAuthStateChanged(auth, user=>{
  if(user){
    navAuth.innerHTML=`<a class="nav-link" href="#" id="nav-logout">Logout (${user.email||user.uid})</a>`;
    document.getElementById('nav-logout')?.addEventListener('click', async e=>{
      e.preventDefault();
      await signOut(auth);
      window.location.href='home.html';
    });
  } else {
    alert('Access denied. Only logged-in users can view this page.');
    window.location.href='login.html';
  }
});

// Pull contacts from Firebase and display
const contactCards = document.getElementById('contactCards');
const contactsRef = ref(db,'contacts');

onValue(contactsRef, snapshot => {
  contactCards.innerHTML = ''; // clear
  snapshot.forEach(childSnap=>{
    const data = childSnap.val();
    const id = childSnap.key;

    const card = document.createElement('div');
    card.classList.add('contact-card','p-3','mb-3');

    card.innerHTML = `
      <div class="card-header">${data.firstName} ${data.lastName} <small class="text-muted">(${new Date(data.timestamp).toLocaleString()})</small></div>
      <div class="card-body">
        <p><strong>Email:</strong> ${data.email}</p>
        <p><strong>Topic:</strong> ${data.topic}</p>
        <p><strong>Message:</strong> ${data.message}</p>
        <p><strong>Preferred Contact:</strong> ${data.preferredContactMethod}</p>
        <p><strong>Updates:</strong> ${data.updates ? 'Yes' : 'No'}</p>
        <p><strong>Status:</strong> ${data.status}</p>
        <button class="btn btn-sm btn-success" onclick="updateStatus('${id}','done')">Mark as done</button>
        <button class="btn btn-sm btn-danger" onclick="deleteContact('${id}')">Delete</button>
      </div>
    `;
    contactCards.appendChild(card);
    setTimeout(()=>card.classList.add('show'),50);
  });
});

// Functions to update or delete contact
window.updateStatus = (id,status)=>update(ref(db,'contacts/'+id),{status});
window.deleteContact = id=>remove(ref(db,'contacts/'+id));
</script>
</body>
</html>
